export const sampleEncodedPolyline =
  "a}snGrpfiNPuADy@CwAGgAiBiNi@oEkG{d@MqAE{@?mA@u@JkANcAR_AV{@\\u@v@kAX[n@g@t@a@hA[nWsD~@KnFy@RG^CzXoE~@W^Qz@m@`A_A\\QT?`@FZVR^L?JIXkA@[I{@Ac@Hs@L_@v@oAn@kA\\aAXiAT}AJuBAmAQ_C}Igr@eBmLk@kFAk@HONGhI_Adi@sHdZgExTiD|K}AjSkChEu@`[uE`@@PXH^d@fE`@hCRfB^`CvBdQnAjJd@~C\\hCTtAT~@nBhGX`AHf@l@~FHtATlBTnFH|@DjATpCv@tFlAxGz@tDV~@^|@HFBGAGGEABPn@pB|ExA~DbA`ClAjBbKxNhAtATLj@h@t@\\|EfBtAp@|@x@v@lA`@|@d@dBVzA`@rCjL~{@rA~JLt@`@nDbClQlB`MlElWVrBxA`IXfCNjBB|AAhCBvADlAJnAbGvf@|CdUtAvKHZD@BIaBmMyB}Os@yFQ}@GSQULC?OkEu^MyAK_CCiGIcBe@yD_@yBCGCAEF@Hd@rB`@fDJfC@fGB`AF|@F?BYEWGEABBfAx@vGV|BHf@RjBjB`OEf@YV{Eh@_H`AsAXcIlA_KnA}Bb@i@Di@LmC^aO~A{RlCoLfBQAEIQN]HaOxBaCb@iY~DkSpC{JzAiRpC{@JQ?GEEOaA_IqAmJ{C_VQgAGCAFBBDGASoAwIwD_Z_Fg_@a@gDg@iD_Fs_@uAwJIQMIe@EaOhC_AAaAYi@]e@i@e@{@Us@W_Bu@aGMyA?}@Dk@NcARm@@GGITKh@u@n@c@v@UdC]J?NJJQZKzL}AzHiAf@WZYTa@Rk@NaAf@gN?qAIuAQyAWqAUgAa@_Bs@yB_CoGg@gBMy@G{@@}AJ{Ap@gE\\eB\\eAvEaLlAoCt@eA~AsAZ_@Ve@Rm@J}@?}@Ca@OcA[s@QWQQc@Yg@McABqe@pHmIfAg@?wBQ]Mk@u@KGKAWHQXEP?NBNFLRPJBTGHKJ_@Ca@GOIMKEK?KFKNEP?b@FNHHLDVCHIFMBOC]O[KEY@mAd@YNeBfBa@Zo@\\oA\\aMlBaGv@{AXqC^aFz@aEj@_Cd@uLfB_APm@Vy@d@g@d@e@j@i@|@[p@]hAY|AKfAGzAAfAJxARdB`BxL`B`MfAdJ|AzKn@~EHnAAn@GvAUzA";

export const sampleLatLngArray = {
  type: "LineString",
  coordinates: [
    { lat: -79.34631, lng: 43.76202 },
    { lat: -79.34591, lng: 43.76232 },
    { lat: -79.34499, lng: 43.7632 },
    { lat: -79.34484, lng: 43.7635 },
    { lat: -79.34489, lng: 43.7642 },
    { lat: -79.34474, lng: 43.76447 },
    { lat: -79.34438, lng: 43.76471 },
    { lat: -79.34342, lng: 43.7649 },
    { lat: -79.34285, lng: 43.76486 },
    { lat: -79.34243, lng: 43.76465 },
    { lat: -79.34217, lng: 43.76428 },
    { lat: -79.34182, lng: 43.76349 },
    { lat: -79.34169, lng: 43.7634 },
    { lat: -79.34096, lng: 43.7633 },
    { lat: -79.33935, lng: 43.76366 },
    { lat: -79.3391, lng: 43.76361 },
    { lat: -79.33839, lng: 43.76218 },
    { lat: -79.33818, lng: 43.76204 },
    { lat: -79.33778, lng: 43.76202 },
    { lat: -79.3354, lng: 43.76265 },
    { lat: -79.33519, lng: 43.76321 },
    { lat: -79.33485, lng: 43.7636 },
    { lat: -79.33257, lng: 43.76504 },
    { lat: -79.33199, lng: 43.76522 },
    { lat: -79.33019, lng: 43.76555 },
    { lat: -79.33004, lng: 43.76553 },
    { lat: -79.32993, lng: 43.76543 },
    { lat: -79.32937, lng: 43.76383 },
    { lat: -79.32876, lng: 43.76299 },
    { lat: -79.32851, lng: 43.76141 },
    { lat: -79.328, lng: 43.76086 },
    { lat: -79.32612, lng: 43.75924 },
    { lat: -79.32614, lng: 43.75907 },
    { lat: -79.32633, lng: 43.75894 },
    { lat: -79.32753, lng: 43.75856 },
    { lat: -79.32755, lng: 43.75836 },
    { lat: -79.32643, lng: 43.75675 },
    { lat: -79.32608, lng: 43.75665 },
    { lat: -79.32485, lng: 43.75678 },
    { lat: -79.32435, lng: 43.75669 },
    { lat: -79.32063, lng: 43.75436 },
    { lat: -79.32065, lng: 43.75416 },
    { lat: -79.32164, lng: 43.75392 },
    { lat: -79.32175, lng: 43.75375 },
    { lat: -79.32128, lng: 43.75264 },
    { lat: -79.32083, lng: 43.75129 },
    { lat: -79.31992, lng: 43.75021 },
    { lat: -79.31952, lng: 43.74937 },
    { lat: -79.31958, lng: 43.74925 },
    { lat: -79.31974, lng: 43.74921 },
    { lat: -79.32615, lng: 43.74776 },
    { lat: -79.32628, lng: 43.74768 },
    { lat: -79.32587, lng: 43.74585 },
    { lat: -79.32618, lng: 43.74442 },
    { lat: -79.32615, lng: 43.74398 },
    { lat: -79.32468, lng: 43.74061 },
    { lat: -79.3246, lng: 43.74019 },
    { lat: -79.32487, lng: 43.7397 },
    { lat: -79.32614, lng: 43.73867 },
    { lat: -79.32723, lng: 43.73703 },
    { lat: -79.3274, lng: 43.73659 },
    { lat: -79.32724, lng: 43.736 },
    { lat: -79.32684, lng: 43.73563 },
    { lat: -79.3262, lng: 43.73545 },
    { lat: -79.32556, lng: 43.73551 },
    { lat: -79.32504, lng: 43.73566 },
    { lat: -79.32469, lng: 43.73584 },
    { lat: -79.31949, lng: 43.74034 },
    { lat: -79.31926, lng: 43.74062 },
    { lat: -79.31907, lng: 43.74113 },
    { lat: -79.31434, lng: 43.74141 },
    { lat: -79.31424, lng: 43.74115 },
    { lat: -79.31443, lng: 43.74082 },
    { lat: -79.31776, lng: 43.73758 },
    { lat: -79.31779, lng: 43.73747 },
    { lat: -79.31742, lng: 43.73723 },
    { lat: -79.31721, lng: 43.7372 },
    { lat: -79.31655, lng: 43.73775 },
    { lat: -79.31632, lng: 43.73782 },
    { lat: -79.31491, lng: 43.73708 },
    { lat: -79.31282, lng: 43.73683 },
    { lat: -79.31271, lng: 43.73651 },
    { lat: -79.31249, lng: 43.7363 },
    { lat: -79.31189, lng: 43.73463 },
    { lat: -79.31086, lng: 43.7335 },
    { lat: -79.31005, lng: 43.73151 },
    { lat: -79.3097, lng: 43.72965 },
    { lat: -79.30989, lng: 43.72882 },
    { lat: -79.31039, lng: 43.72822 },
    { lat: -79.31105, lng: 43.72769 },
    { lat: -79.31167, lng: 43.72735 },
    { lat: -79.31275, lng: 43.72692 },
    { lat: -79.31337, lng: 43.72643 },
    { lat: -79.31396, lng: 43.72485 },
    { lat: -79.31576, lng: 43.72225 },
    { lat: -79.31601, lng: 43.72171 },
    { lat: -79.31597, lng: 43.72128 },
    { lat: -79.31581, lng: 43.72097 },
    { lat: -79.31461, lng: 43.71971 },
    { lat: -79.3144, lng: 43.71939 },
    { lat: -79.31258, lng: 43.71508 },
    { lat: -79.3126, lng: 43.71489 },
    { lat: -79.31291, lng: 43.71478 },
    { lat: -79.31333, lng: 43.71491 },
    { lat: -79.3136, lng: 43.71492 },
    { lat: -79.31459, lng: 43.71469 },
    { lat: -79.31634, lng: 43.71345 },
    { lat: -79.31723, lng: 43.71227 },
    { lat: -79.31786, lng: 43.71063 },
    { lat: -79.31877, lng: 43.70974 },
    { lat: -79.31871, lng: 43.70956 },
    { lat: -79.31815, lng: 43.70933 },
    { lat: -79.31807, lng: 43.70923 },
    { lat: -79.31847, lng: 43.70872 },
    { lat: -79.3188, lng: 43.70862 },
    { lat: -79.32009, lng: 43.70856 },
    { lat: -79.32039, lng: 43.70861 },
    { lat: -79.32164, lng: 43.70909 },
    { lat: -79.32083, lng: 43.70873 },
    { lat: -79.32089, lng: 43.7085 },
    { lat: -79.32117, lng: 43.70822 },
    { lat: -79.32336, lng: 43.70803 },
    { lat: -79.32483, lng: 43.7075 },
    { lat: -79.32524, lng: 43.70722 },
    { lat: -79.32538, lng: 43.70693 },
    { lat: -79.32556, lng: 43.70577 },
    { lat: -79.32583, lng: 43.70489 },
    { lat: -79.32604, lng: 43.70464 },
    { lat: -79.32859, lng: 43.70443 },
    { lat: -79.32971, lng: 43.70451 },
    { lat: -79.32995, lng: 43.70441 },
    { lat: -79.33004, lng: 43.70421 },
    { lat: -79.33004, lng: 43.70396 },
    { lat: -79.3299, lng: 43.70385 },
    { lat: -79.32892, lng: 43.70382 },
    { lat: -79.32823, lng: 43.70352 },
    { lat: -79.32794, lng: 43.70348 },
    { lat: -79.327, lng: 43.70373 },
    { lat: -79.32558, lng: 43.7037 },
    { lat: -79.32518, lng: 43.70374 },
    { lat: -79.32482, lng: 43.70389 },
    { lat: -79.32409, lng: 43.70437 },
    { lat: -79.32307, lng: 43.70464 },
    { lat: -79.32248, lng: 43.70466 },
    { lat: -79.31921, lng: 43.70432 },
    { lat: -79.31564, lng: 43.70509 },
    { lat: -79.31471, lng: 43.70507 },
    { lat: -79.31384, lng: 43.70454 },
    { lat: -79.31393, lng: 43.70431 },
    { lat: -79.31545, lng: 43.70292 },
    { lat: -79.31909, lng: 43.70011 },
    { lat: -79.3191, lng: 43.69991 },
    { lat: -79.31853, lng: 43.69883 },
    { lat: -79.31834, lng: 43.6982 },
    { lat: -79.34234, lng: 43.69305 },
    { lat: -79.34245, lng: 43.69297 },
    { lat: -79.34248, lng: 43.69274 },
    { lat: -79.34264, lng: 43.69268 },
    { lat: -79.35515, lng: 43.69026 },
    { lat: -79.35496, lng: 43.68937 },
    { lat: -79.35685, lng: 43.6847 },
    { lat: -79.35808, lng: 43.68001 },
    { lat: -79.35832, lng: 43.67887 },
    { lat: -79.35824, lng: 43.67872 },
    { lat: -79.3583, lng: 43.67845 },
    { lat: -79.35847, lng: 43.6783 },
    { lat: -79.359, lng: 43.67649 },
    { lat: -79.35884, lng: 43.67626 },
    { lat: -79.3585, lng: 43.67621 },
    { lat: -79.35614, lng: 43.67671 },
    { lat: -79.35343, lng: 43.67715 },
    { lat: -79.34489, lng: 43.67884 },
    { lat: -79.34325, lng: 43.67922 },
    { lat: -79.33756, lng: 43.68027 },
    { lat: -79.33231, lng: 43.68138 },
    { lat: -79.32748, lng: 43.68247 },
    { lat: -79.32447, lng: 43.68307 },
    { lat: -79.31864, lng: 43.68432 },
    { lat: -79.31782, lng: 43.68454 },
    { lat: -79.31257, lng: 43.68561 },
    { lat: -79.3079, lng: 43.68678 },
    { lat: -79.30676, lng: 43.68698 },
    { lat: -79.29988, lng: 43.68847 },
    { lat: -79.29797, lng: 43.68897 },
    { lat: -79.28971, lng: 43.69083 },
    { lat: -79.28805, lng: 43.69127 },
    { lat: -79.27742, lng: 43.69362 },
    { lat: -79.27702, lng: 43.6939 },
    { lat: -79.27628, lng: 43.69486 },
    { lat: -79.27506, lng: 43.69655 },
    { lat: -79.27437, lng: 43.69787 },
    { lat: -79.2735, lng: 43.69892 },
    { lat: -79.2723, lng: 43.70067 },
  ],
};

export const decode = (encodedPolyline) => {
  var encodedPolyline = document.getElementById("encoded-polyline").value;
  document.getElementById("geojson").value = encodedPolyline;
  var coords = polyline.toGeoJSON(encodedPolyline);
  document.getElementById("geojson").value = JSON.stringify(coords);
};

var polyline = {};

const encode = (current, previous, factor) => {
  current = Math.round(current * factor);
  previous = Math.round(previous * factor);
  var coordinate = current - previous;
  coordinate <<= 1;
  if (current - previous < 0) {
    coordinate = ~coordinate;
  }
  var output = "";
  while (coordinate >= 0x20) {
    output += String.fromCharCode((0x20 | (coordinate & 0x1f)) + 63);
    coordinate >>= 5;
  }
  output += String.fromCharCode(coordinate + 63);
  return output;
};

/**
 * Decodes to a [latitude, longitude] coordinates array.
 *
 * This is adapted from the implementation in Project-OSRM.
 *
 * @param {String} str
 * @param {Number} precision
 * @returns {Array}
 *
 * @see https://github.com/Project-OSRM/osrm-frontend/blob/master/WebContent/routing/OSRM.RoutingGeometry.js
 */
polyline.decode = function (str, precision) {
  var index = 0,
    lat = 0,
    lng = 0,
    coordinates = [],
    shift = 0,
    result = 0,
    byte = null,
    latitude_change,
    longitude_change,
    factor = Math.pow(10, precision || 5);

  // Coordinates have variable length when encoded, so just keep
  // track of whether we've hit the end of the string. In each
  // loop iteration, a single coordinate is decoded.
  while (index < str.length) {
    // Reset shift, result, and byte
    byte = null;
    shift = 0;
    result = 0;

    do {
      byte = str.charCodeAt(index++) - 63;
      result |= (byte & 0x1f) << shift;
      shift += 5;
    } while (byte >= 0x20);

    latitude_change = result & 1 ? ~(result >> 1) : result >> 1;

    shift = result = 0;

    do {
      byte = str.charCodeAt(index++) - 63;
      result |= (byte & 0x1f) << shift;
      shift += 5;
    } while (byte >= 0x20);

    longitude_change = result & 1 ? ~(result >> 1) : result >> 1;

    lat += latitude_change;
    lng += longitude_change;

    coordinates.push([lat / factor, lng / factor]);
  }

  return coordinates;
};

/**
 * Encodes the given [latitude, longitude] coordinates array.
 *
 * @param {Array.<Array.<Number>>} coordinates
 * @param {Number} precision
 * @returns {String}
 */
polyline.encode = function (coordinates, precision) {
  if (!coordinates.length) {
    return "";
  }

  var factor = Math.pow(10, precision || 5),
    output =
      encode(coordinates[0][0], 0, factor) +
      encode(coordinates[0][1], 0, factor);

  for (var i = 1; i < coordinates.length; i++) {
    var a = coordinates[i],
      b = coordinates[i - 1];
    output += encode(a[0], b[0], factor);
    output += encode(a[1], b[1], factor);
  }

  return output;
};

function flipped(coords) {
  var flipped = [];
  for (var i = 0; i < coords.length; i++) {
    flipped.push(coords[i].slice().reverse());
  }
  return flipped;
}

/**
 * Encodes a GeoJSON LineString feature/geometry.
 *
 * @param {Object} geojson
 * @param {Number} precision
 * @returns {String}
 */
polyline.fromGeoJSON = function (geojson, precision) {
  if (geojson && geojson.type === "Feature") {
    geojson = geojson.geometry;
  }
  if (!geojson || geojson.type !== "LineString") {
    throw new Error("Input must be a GeoJSON LineString");
  }
  return polyline.encode(flipped(geojson.coordinates), precision);
};

/**
 * Decodes to a GeoJSON LineString geometry.
 *
 * @param {String} str
 * @param {Number} precision
 * @returns {Object}
 */
polyline.toGeoJSON = function (str, precision) {
  var coords = polyline.decode(str, precision);
  return {
    type: "LineString",
    coordinates: flipped(coords),
  };
};

if (typeof module === "object" && module.exports) {
  module.exports = polyline;
}
